name: Infra Setup
on: workflow_dispatch
jobs:
#  Terraform-Init:
#    runs-on: self-hosted
#    steps:
#      - name: Check out repository code
#        uses: actions/checkout@v4
#      - name: Terraform init
#        run: |
#          terraform init -backend-config=env-dev/state.tfvars
#
#  Terraform-Plan:
#    runs-on: self-hosted
#    steps:
#      - name: Check out repository code
#        uses: actions/checkout@v4
#      - name: Terraform init
#        run: |
#          terraform plan -var-file=env-dev/main.tfvars

#  Terraform-Apply:
#    runs-on: self-hosted
#    steps:
#      - name: Check out repository code
#        uses: actions/checkout@v4
#      - name: Terraform Apply
#        run: |
#          export PATH=/home/github/.local/bin:/home/github/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
#          terraform init -backend-config=env-dev/state.tfvars
#          terraform apply -var-file=env-dev/main.tfvars -var vault_token=${vault_token} -auto-approve
#          #terraform plan -var-file=env-dev/main.tfvars -var vault_token=${vault_token} 2>&1 | tail -n6 | head -n1 >$GITHUB_STEP_SUMMARY
#        env:
#          vault_token: ${{ secrets.vault_token }}

  Helm-Install-Applications:
    #needs: Terraform-Apply
    runs-on: ubuntu-latest
    permissions:
      actions: write
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
        with:
          repository: vsaitejasgitorg/roboshop-cart
          path: helm
      - name: Helm Install
        run: |
          export PATH=/home/github/.local/bin:/home/github/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
          gh workflow ls
          #cd helm
          #make dev
